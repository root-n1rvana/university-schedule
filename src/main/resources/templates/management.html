<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- Your header content here -->
</head>
<body>
<div>
    <form th:action="@{/management}" method="post">
        <label for="loginName">User Login Name:</label>
        <input type="text" id="loginName" name="loginName" required/>
        <button type="submit">Find User</button>
    </form>
</div>
<div th:if="${user}">
    <h2>User Data:</h2>
    <p>Username: <span th:text="${user.userName}"></span></p>
    <p>Lastname: <span th:text="${user.userLastname}"></span></p>
    <p>Group: <span th:text="${user.ownerGroup.name}"></span></p>

    <p>Roles:
        <span th:each="role, iterStat : ${user.roles}">
            <span th:text="${role.roleName}"></span>
            <span th:unless="${iterStat.last}">, </span>
        </span>
    </p>
</div>

<div th:if="${user}">
    <h2>Select Role and Group:</h2>
    <form th:action="@{/updateUser}" method="post">
        <input type="hidden" th:name="userId" th:value="${user.id}"/>

        <p>Roles:
            <span th:each="role : ${allRoles}">
                <label th:text="${role.roleName}" th:for="'role-' + ${role.id}"></label>
                <input type="checkbox" th:id="'role-' + ${role.id}" th:name="'roles'" th:value="${role.id}"/>
            </span>
        </p>

        <label for="group">Group:</label>
        <select id="group" name="group">
            <option th:each="group : ${allGroups}" th:value="${group.id}" th:text="${group.name}"
                    th:selected="${group.id == user.ownerGroup.id}"></option>
        </select>
        <button type="submit">Update User</button>
    </form>
</div>
</body>
<script th:inline="javascript">
    function updateRoleIds() {
        const roleIdsInput = document.getElementById("roleIdsInput");
        const checkboxes = document.querySelectorAll("input[type='checkbox']");

        const selectedRoleIds = Array.from(checkboxes)
            .filter(checkbox => checkbox.checked)
            .map(checkbox => checkbox.getAttribute("data-roleId"));

        roleIdsInput.value = selectedRoleIds.join(",");
    }
</script>
</html>